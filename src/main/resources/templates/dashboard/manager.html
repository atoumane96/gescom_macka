<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: layout(~{::title}, ~{::content}, ~{::js_assets})}">
<head>
    <title>Tableau de bord Manager</title>
</head>
<body>
<style>
    /* Variables CSS professionnelles */
    :root {
        --primary-color: #1f2937;
        --primary-light: #374151;
        --success-color: #059669;
        --warning-color: #d97706;
        --danger-color: #dc2626;
        --info-color: #0369a1;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
        --blue-600: #2563eb;
        --green-600: #059669;
        --orange-600: #ea580c;
        --red-600: #dc2626;
        --border-radius: 6px;
    }

    /* Base styles */
    body {
        background-color: var(--gray-50);
        color: var(--gray-800);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    h1 {
        color: var(--gray-900);
        font-weight: 600;
        font-size: 1.875rem;
    }

    /* Print styles */
    @media print {
        .btn, .dropdown, nav, .card-header .btn {
            display: none !important;
        }
    }

    /* Cards */
    .card {
        border: 1px solid var(--gray-200);
        border-radius: var(--border-radius);
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        background: white;
    }

    .metric-card {
        transition: box-shadow 0.15s ease-in-out;
    }

    .metric-card:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    .card-header {
        background: var(--gray-50);
        border-bottom: 1px solid var(--gray-200);
        padding: 1rem 1.25rem;
        font-weight: 600;
        color: var(--gray-800);
    }

    .card-header h5 {
        margin: 0;
        color: var(--gray-800);
        font-size: 1rem;
    }

    .card-body {
        padding: 1.25rem;
    }

    /* Border colors for metric cards */
    .border-primary {
        border-left: 4px solid var(--blue-600) !important;
        border-top: 1px solid var(--gray-200) !important;
        border-right: 1px solid var(--gray-200) !important;
        border-bottom: 1px solid var(--gray-200) !important;
    }

    .border-success {
        border-left: 4px solid var(--green-600) !important;
        border-top: 1px solid var(--gray-200) !important;
        border-right: 1px solid var(--gray-200) !important;
        border-bottom: 1px solid var(--gray-200) !important;
    }

    .border-info {
        border-left: 4px solid var(--info-color) !important;
        border-top: 1px solid var(--gray-200) !important;
        border-right: 1px solid var(--gray-200) !important;
        border-bottom: 1px solid var(--gray-200) !important;
    }

    .border-warning {
        border-left: 4px solid var(--warning-color) !important;
        border-top: 1px solid var(--gray-200) !important;
        border-right: 1px solid var(--gray-200) !important;
        border-bottom: 1px solid var(--gray-200) !important;
    }

    .border-secondary {
        border-left: 4px solid var(--gray-500) !important;
        border-top: 1px solid var(--gray-200) !important;
        border-right: 1px solid var(--gray-200) !important;
        border-bottom: 1px solid var(--gray-200) !important;
    }

    /* Text colors */
    .text-primary { color: var(--blue-600) !important; }
    .text-success { color: var(--success-color) !important; }
    .text-warning { color: var(--warning-color) !important; }
    .text-danger { color: var(--danger-color) !important; }
    .text-info { color: var(--info-color) !important; }
    .text-muted { color: var(--gray-500) !important; }

    /* Progress bars */
    .progress {
        background-color: var(--gray-200);
        border-radius: 4px;
        height: 8px;
    }

    .progress-bar {
        border-radius: 4px;
    }

    .bg-primary { background-color: var(--blue-600) !important; }
    .bg-success { background-color: var(--success-color) !important; }
    .bg-warning { background-color: var(--warning-color) !important; }
    .bg-danger { background-color: var(--danger-color) !important; }
    .bg-info { background-color: var(--info-color) !important; }

    /* Background opacity classes */
    .bg-primary.bg-opacity-10 { background-color: rgba(37, 99, 235, 0.1) !important; }
    .bg-success.bg-opacity-10 { background-color: rgba(5, 150, 105, 0.1) !important; }
    .bg-warning.bg-opacity-10 { background-color: rgba(217, 119, 6, 0.1) !important; }
    .bg-danger.bg-opacity-10 { background-color: rgba(220, 38, 38, 0.1) !important; }
    .bg-info.bg-opacity-10 { background-color: rgba(3, 105, 161, 0.1) !important; }

    /* Table styles */
    .table {
        color: var(--gray-800);
    }

    .table th {
        font-weight: 600;
        color: var(--gray-700);
        border-bottom: 2px solid var(--gray-200);
        background-color: var(--gray-50);
        font-size: 0.875rem;
    }

    .table td {
        vertical-align: middle;
        border-color: var(--gray-200);
    }

    .table tbody tr:hover {
        background-color: var(--gray-50);
    }

    /* Buttons */
    .btn {
        border-radius: var(--border-radius);
        font-weight: 500;
        font-size: 0.875rem;
        transition: all 0.15s ease-in-out;
    }

    .btn-primary {
        background-color: var(--blue-600);
        border-color: var(--blue-600);
        color: white;
    }

    .btn-primary:hover {
        background-color: #1d4ed8;
        border-color: #1d4ed8;
    }

    .btn-success {
        background-color: var(--success-color);
        border-color: var(--success-color);
        color: white;
    }

    .btn-success:hover {
        background-color: #047857;
        border-color: #047857;
    }

    .btn-warning {
        background-color: var(--warning-color);
        border-color: var(--warning-color);
        color: white;
    }

    .btn-warning:hover {
        background-color: #c2410c;
        border-color: #c2410c;
    }

    .btn-danger {
        background-color: var(--danger-color);
        border-color: var(--danger-color);
        color: white;
    }

    .btn-danger:hover {
        background-color: #b91c1c;
        border-color: #b91c1c;
    }

    .btn-info {
        background-color: var(--info-color);
        border-color: var(--info-color);
        color: white;
    }

    .btn-info:hover {
        background-color: #0284c7;
        border-color: #0284c7;
    }

    .btn-secondary {
        background-color: var(--gray-500);
        border-color: var(--gray-500);
        color: white;
    }

    .btn-secondary:hover {
        background-color: var(--gray-600);
        border-color: var(--gray-600);
    }

    /* Outline buttons */
    .btn-outline-primary {
        border-color: var(--blue-600);
        color: var(--blue-600);
    }

    .btn-outline-primary:hover {
        background-color: var(--blue-600);
        border-color: var(--blue-600);
        color: white;
    }

    .btn-outline-secondary {
        border-color: var(--gray-300);
        color: var(--gray-600);
    }

    .btn-outline-secondary:hover {
        background-color: var(--gray-600);
        border-color: var(--gray-600);
        color: white;
    }

    .btn-outline-success {
        border-color: var(--success-color);
        color: var(--success-color);
    }

    .btn-outline-success:hover {
        background-color: var(--success-color);
        border-color: var(--success-color);
        color: white;
    }

    .btn-outline-warning {
        border-color: var(--warning-color);
        color: var(--warning-color);
    }

    .btn-outline-warning:hover {
        background-color: var(--warning-color);
        border-color: var(--warning-color);
        color: white;
    }

    .btn-outline-info {
        border-color: var(--info-color);
        color: var(--info-color);
    }

    .btn-outline-info:hover {
        background-color: var(--info-color);
        border-color: var(--info-color);
        color: white;
    }

    /* Button group */
    .btn-group .btn.active {
        background-color: var(--blue-600);
        border-color: var(--blue-600);
        color: white;
    }

    /* Badges */
    .badge {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-weight: 500;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .badge.bg-success {
        background-color: var(--success-color) !important;
        color: white;
    }

    .badge.bg-warning {
        background-color: var(--warning-color) !important;
        color: white;
    }

    .badge.bg-danger {
        background-color: var(--danger-color) !important;
        color: white;
    }

    .badge.bg-primary {
        background-color: var(--blue-600) !important;
        color: white;
    }

    .badge.bg-secondary {
        background-color: var(--gray-500) !important;
        color: white;
    }

    .badge.bg-light {
        background-color: var(--gray-100) !important;
        color: var(--gray-800) !important;
    }

    .badge.rounded-pill {
        border-radius: 50rem;
    }

    /* Chart container */
    #teamPerformanceChart {
        height: 300px !important;
    }

    /* List group */
    .list-group-item {
        border-left: none;
        border-right: none;
        border-color: var(--gray-200);
        background-color: transparent;
    }

    .list-group-item:first-child {
        border-top: none;
    }

    .list-group-item:last-child {
        border-bottom: none;
    }

    .list-group-flush .list-group-item {
        border-width: 0 0 1px;
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
        .d-flex.flex-wrap .btn-group {
            margin-bottom: 0.5rem;
        }

        .card-body h2 {
            font-size: 1.5rem;
        }

        h1 {
            font-size: 1.5rem;
        }
    }

    /* Utilities */
    .rounded-circle {
        border-radius: 50% !important;
    }

    .fw-bold {
        font-weight: 700 !important;
    }

    /* Alert improvements for notifications */
    .alert {
        border: none;
        border-radius: var(--border-radius);
    }

    .alert-success {
        background-color: rgba(5, 150, 105, 0.1);
        color: var(--success-color);
        border-left: 4px solid var(--success-color);
    }

    .alert-danger {
        background-color: rgba(220, 38, 38, 0.1);
        color: var(--danger-color);
        border-left: 4px solid var(--danger-color);
    }

    .alert-warning {
        background-color: rgba(217, 119, 6, 0.1);
        color: var(--warning-color);
        border-left: 4px solid var(--warning-color);
    }

    .alert-info {
        background-color: rgba(3, 105, 161, 0.1);
        color: var(--info-color);
        border-left: 4px solid var(--info-color);
    }

    /* Form controls for date picker */
    .form-control, .form-select {
        border: 1px solid var(--gray-300);
        border-radius: var(--border-radius);
        font-size: 0.875rem;
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--blue-600);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
</style>
<div th:fragment="content">
    <!-- En-tête avec filtres -->
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap">
        <div>
            <h1>
                <i class="fas fa-chart-line me-2 text-primary"></i>
                Tableau de bord Manager
            </h1>
            <p class="text-muted mb-0">
                <i class="fas fa-users me-1"></i>

                <span class="mx-2">•</span>
                <i class="fas fa-calendar me-1"></i>
                Période : <span id="currentPeriod" th:text="${dashboardData?.periodDays ?: 30} + ' jours'">30 jours</span>
            </p>
        </div>
        <div class="d-flex gap-2 flex-wrap">
            <!-- Sélecteur de période -->
            <div class="btn-group" role="group">
                <a th:href="@{/dashboard(days=7)}" class="btn btn-outline-primary btn-sm"
                   th:classappend="${dashboardData?.periodDays == 7} ? 'active' : ''">
                    <i class="fas fa-calendar-day me-1"></i>7j
                </a>
                <a th:href="@{/dashboard(days=30)}" class="btn btn-outline-primary btn-sm"
                   th:classappend="${dashboardData?.periodDays == 30} ? 'active' : ''">
                    <i class="fas fa-calendar-week me-1"></i>30j
                </a>
                <a th:href="@{/dashboard(days=90)}" class="btn btn-outline-primary btn-sm"
                   th:classappend="${dashboardData?.periodDays == 90} ? 'active' : ''">
                    <i class="fas fa-calendar-alt me-1"></i>90j
                </a>
            </div>

            <!-- Date range picker -->
            <button class="btn btn-outline-secondary btn-sm" id="dateRangePicker">
                <i class="fas fa-calendar-range me-1"></i>Période personnalisée
            </button>

            <!-- Actions -->
            <div class="btn-group">
                <button class="btn btn-success btn-sm" onclick="exportReport()">
                    <i class="fas fa-download me-1"></i>Exporter
                </button>
                <button class="btn btn-info btn-sm" onclick="refreshData()">
                    <i class="fas fa-sync-alt me-1"></i>Actualiser
                </button>
            </div>
        </div>
    </div>

    <!-- Alertes et notifications importantes -->
    <div class="row mb-4">
        <div class="col-12">
            <!-- Alerte stock bas -->
            <div class="alert alert-warning alert-dismissible fade show">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Stock faible :</strong> 12 produits ont un stock inférieur au seuil minimum. 
                <a href="/products?lowStock=true" class="alert-link">Voir les produits</a>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            
            <!-- Alerte objectifs -->
            <div class="alert alert-info alert-dismissible fade show">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Objectifs :</strong> L'équipe est à 87.5% de l'objectif mensuel. Il reste 8 jours pour atteindre 100%.
                <a href="#objectifs" class="alert-link">Voir détails</a>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            
            <!-- Alerte nouvelle commande -->
            <div class="alert alert-success alert-dismissible fade show">
                <i class="fas fa-check-circle me-2"></i>
                <strong>Nouvelle commande :</strong> Commande #CMD-2024-1247 de 2 850€ reçue il y a 15 minutes.
                <a href="/orders/1247" class="alert-link">Voir commande</a>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        </div>
    </div>

    <!-- Métriques principales -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card metric-card border-primary">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="card-title text-muted mb-2">
                                <i class="fas fa-euro-sign me-1"></i>CA Équipe
                            </h6>
                            <h2 class="text-primary mb-1" th:text="${dashboardData?.totalRevenue ? #numbers.formatCurrency(dashboardData.totalRevenue) : '125 850 €'}">125 850 €</h2>
                            <small class="text-muted">
                                5 vendeurs actifs
                            </small>
                        </div>
                        <div class="ms-3">
                            <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-chart-line text-primary fa-lg"></i>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="d-flex align-items-center">
                            <span class="badge bg-success me-2" th:if="${dashboardData?.revenueGrowth != null and dashboardData.revenueGrowth > 0}">
                                <i class="fas fa-arrow-up me-1"></i><span th:text="${#numbers.formatDecimal(dashboardData.revenueGrowth, 1, 1)}">0</span>%
                            </span>
                            <span class="badge bg-danger me-2" th:if="${dashboardData?.revenueGrowth != null and dashboardData.revenueGrowth < 0}">
                                <i class="fas fa-arrow-down me-1"></i><span th:text="${#numbers.formatDecimal(dashboardData.revenueGrowth, 1, 1)}">0</span>%
                            </span>
                            <span class="badge bg-success me-2" th:if="${dashboardData?.revenueGrowth == null}">
                                <i class="fas fa-arrow-up me-1"></i>12.5%
                            </span>
                            <small class="text-muted">vs période précédente</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card metric-card border-secondary">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="card-title text-muted mb-2">
                                <i class="fas fa-bullseye me-1"></i>Objectif Global
                            </h6>
                            <h2 class="mb-1 text-primary">87.5%</h2>
                            <small class="text-muted">En bonne voie</small>
                        </div>
                        <div class="ms-3">
                            <div class="rounded-circle d-flex align-items-center justify-content-center bg-secondary bg-opacity-10"
                                 style="width: 50px; height: 50px;">
                                <i class="fas fa-target fa-lg text-secondary"></i>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-primary" style="width: 87.5%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card metric-card border-success">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="card-title text-muted mb-2">
                                <i class="fas fa-shopping-cart me-1"></i>Commandes
                            </h6>
                            <h2 class="text-success mb-1" th:text="${dashboardData?.totalOrders ?: 234}">234</h2>
                            <small class="text-muted">Cette période</small>
                        </div>
                        <div class="ms-3">
                            <div class="bg-success bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-shopping-bag text-success fa-lg"></i>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-chart-bar me-1"></i>
                            Moyenne: 537 € par commande
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card metric-card border-info">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h6 class="card-title text-muted mb-2">
                                <i class="fas fa-users me-1"></i>Clients
                            </h6>
                            <h2 class="text-info mb-1" th:text="${dashboardData?.totalClients ?: 156}">156</h2>
                            <small class="text-muted">
                                +18 nouveaux
                            </small>
                        </div>
                        <div class="ms-3">
                            <div class="bg-info bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                <i class="fas fa-user-plus text-info fa-lg"></i>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3">
                        <small class="text-muted">
                            <i class="fas fa-percentage me-1"></i>
                            Taux conversion: 68.2%
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Widgets supplémentaires -->
    <div class="row mb-4">
        <!-- Progression des objectifs -->
        <div class="col-lg-4 mb-3">
            <div class="card border-primary">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bullseye me-2 text-primary"></i>Objectifs du mois
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <small class="fw-bold">Chiffre d'affaires</small>
                            <small class="text-primary fw-bold">87.5%</small>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-primary" style="width: 87.5%"></div>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <small class="text-muted">125 850 € / 144 000 €</small>
                            <small class="text-muted">18 150 € restants</small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-1">
                            <small class="fw-bold">Nouveaux clients</small>
                            <small class="text-success fw-bold">120%</small>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-success" style="width: 100%"></div>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <small class="text-muted">18 / 15 clients</small>
                            <small class="text-success">+3 en bonus</small>
                        </div>
                    </div>
                    
                    <div class="mb-0">
                        <div class="d-flex justify-content-between mb-1">
                            <small class="fw-bold">Commandes traitées</small>
                            <small class="text-warning fw-bold">75%</small>
                        </div>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-warning" style="width: 75%"></div>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <small class="text-muted">234 / 312 commandes</small>
                            <small class="text-muted">78 restantes</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top produits -->
        <div class="col-lg-4 mb-3">
            <div class="card border-success">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-star me-2 text-success"></i>Top Produits
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                        <div>
                            <h6 class="mb-0">Ordinateur Portable HP</h6>
                            <small class="text-muted">45 ventes ce mois</small>
                        </div>
                        <div class="text-end">
                            <div class="fw-bold text-success">31 500 €</div>
                            <small class="text-success">+15%</small>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                        <div>
                            <h6 class="mb-0">Imprimante Canon</h6>
                            <small class="text-muted">38 ventes ce mois</small>
                        </div>
                        <div class="text-end">
                            <div class="fw-bold text-success">22 800 €</div>
                            <small class="text-success">+8%</small>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                        <div>
                            <h6 class="mb-0">Souris Logitech</h6>
                            <small class="text-muted">127 ventes ce mois</small>
                        </div>
                        <div class="text-end">
                            <div class="fw-bold text-success">8 890 €</div>
                            <small class="text-success">+22%</small>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-0">Écran Samsung 24"</h6>
                            <small class="text-muted">29 ventes ce mois</small>
                        </div>
                        <div class="text-end">
                            <div class="fw-bold text-success">7 250 €</div>
                            <small class="text-danger">-3%</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activités récentes -->
        <div class="col-lg-4 mb-3">
            <div class="card border-info">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-clock me-2 text-info"></i>Activités récentes
                    </h5>
                </div>
                <div class="card-body" style="max-height: 320px; overflow-y: auto;">
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-success bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="fas fa-shopping-cart text-success small"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1">Nouvelle commande</h6>
                            <p class="small text-muted mb-1">Marie Dubois a passé une commande de 2 850 €</p>
                            <small class="text-muted">Il y a 15 minutes</small>
                        </div>
                    </div>
                    
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="fas fa-user-plus text-primary small"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1">Nouveau client</h6>
                            <p class="small text-muted mb-1">Entreprise TechnoSoft a été ajoutée</p>
                            <small class="text-muted">Il y a 1 heure</small>
                        </div>
                    </div>
                    
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-warning bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="fas fa-exclamation-triangle text-warning small"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1">Stock faible</h6>
                            <p class="small text-muted mb-1">Imprimante Canon: seulement 3 unités</p>
                            <small class="text-muted">Il y a 2 heures</small>
                        </div>
                    </div>
                    
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-info bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="fas fa-file-invoice text-info small"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1">Facture payée</h6>
                            <p class="small text-muted mb-1">Facture #2024-0156 de 1 245 € payée</p>
                            <small class="text-muted">Il y a 3 heures</small>
                        </div>
                    </div>
                    
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-success bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="fas fa-handshake text-success small"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1">Deal conclu</h6>
                            <p class="small text-muted mb-1">Pierre Martin a finalisé la vente de 8 500 €</p>
                            <small class="text-muted">Il y a 4 heures</small>
                        </div>
                    </div>
                    
                    <div class="d-flex">
                        <div class="me-3">
                            <div class="bg-secondary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="fas fa-cog text-secondary small"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1">Système mis à jour</h6>
                            <p class="small text-muted mb-1">Mise à jour des prix fournisseurs effectuée</p>
                            <small class="text-muted">Il y a 6 heures</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Graphiques et équipe -->
    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-bar me-2"></i>Performance par vendeur
                    </h5>
                    <div class="btn-group btn-group-sm" role="group">
                        <button type="button" class="btn btn-outline-primary active" onclick="switchChart('revenue')">CA</button>
                        <button type="button" class="btn btn-outline-primary" onclick="switchChart('orders')">Commandes</button>
                        <button type="button" class="btn btn-outline-primary" onclick="switchChart('clients')">Clients</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="position-relative">
                        <canvas id="teamPerformanceChart" width="400" height="200"></canvas>
                        <div id="chartLoader" class="position-absolute top-50 start-50 translate-middle" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Chargement...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-users me-2"></i>Mon Équipe
                    </h5>
                    <button class="btn btn-outline-primary btn-sm" onclick="manageTeam()">
                        <i class="fas fa-cog me-1"></i>Gérer
                    </button>
                </div>
                <div class="card-body">
                    <!-- Équipe de démonstration -->
                    <div class="list-group list-group-flush">
                        <!-- Membre 1 -->
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0 py-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                         style="width: 40px; height: 40px;">
                                        <i class="fas fa-user text-primary"></i>
                                    </div>
                                </div>
                                <div>
                                    <strong>Marie Dubois</strong>
                                    <br><small class="text-muted">marie.dubois@gescom.com</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="btn-group btn-group-sm me-2">
                                    <button class="btn btn-outline-primary btn-sm" title="Voir détails">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-success btn-sm" title="Contacter">
                                        <i class="fas fa-envelope"></i>
                                    </button>
                                </div>
                                <span class="badge bg-success rounded-pill">
                                    <i class="fas fa-check"></i>
                                </span>
                            </div>
                        </div>

                        <!-- Membre 2 -->
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0 py-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                         style="width: 40px; height: 40px;">
                                        <i class="fas fa-user text-primary"></i>
                                    </div>
                                </div>
                                <div>
                                    <strong>Pierre Martin</strong>
                                    <br><small class="text-muted">pierre.martin@gescom.com</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="btn-group btn-group-sm me-2">
                                    <button class="btn btn-outline-primary btn-sm" title="Voir détails">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-success btn-sm" title="Contacter">
                                        <i class="fas fa-envelope"></i>
                                    </button>
                                </div>
                                <span class="badge bg-success rounded-pill">
                                    <i class="fas fa-check"></i>
                                </span>
                            </div>
                        </div>

                        <!-- Membre 3 -->
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0 py-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                         style="width: 40px; height: 40px;">
                                        <i class="fas fa-user text-primary"></i>
                                    </div>
                                </div>
                                <div>
                                    <strong>Sophie Legrand</strong>
                                    <br><small class="text-muted">sophie.legrand@gescom.com</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="btn-group btn-group-sm me-2">
                                    <button class="btn btn-outline-primary btn-sm" title="Voir détails">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-success btn-sm" title="Contacter">
                                        <i class="fas fa-envelope"></i>
                                    </button>
                                </div>
                                <span class="badge bg-secondary rounded-pill">
                                    <i class="fas fa-pause"></i>
                                </span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Statistiques détaillées et analyses -->
    <div class="row mb-4">
        <!-- Évolution des ventes -->
        <div class="col-lg-6 mb-3">
            <div class="card border-primary">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-line me-2 text-primary"></i>Évolution du CA (7 derniers jours)
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col">
                            <small class="text-muted">Lun</small>
                            <div class="mt-2">
                                <div class="bg-primary bg-opacity-10 rounded" style="height: 60px; display: flex; align-items: end;">
                                    <div class="bg-primary rounded-bottom" style="width: 100%; height: 45px;"></div>
                                </div>
                                <small class="fw-bold mt-1 d-block">18.2k</small>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted">Mar</small>
                            <div class="mt-2">
                                <div class="bg-primary bg-opacity-10 rounded" style="height: 60px; display: flex; align-items: end;">
                                    <div class="bg-primary rounded-bottom" style="width: 100%; height: 52px;"></div>
                                </div>
                                <small class="fw-bold mt-1 d-block">21.1k</small>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted">Mer</small>
                            <div class="mt-2">
                                <div class="bg-primary bg-opacity-10 rounded" style="height: 60px; display: flex; align-items: end;">
                                    <div class="bg-primary rounded-bottom" style="width: 100%; height: 38px;"></div>
                                </div>
                                <small class="fw-bold mt-1 d-block">15.8k</small>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted">Jeu</small>
                            <div class="mt-2">
                                <div class="bg-success bg-opacity-10 rounded" style="height: 60px; display: flex; align-items: end;">
                                    <div class="bg-success rounded-bottom" style="width: 100%; height: 60px;"></div>
                                </div>
                                <small class="fw-bold mt-1 d-block">24.5k</small>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted">Ven</small>
                            <div class="mt-2">
                                <div class="bg-primary bg-opacity-10 rounded" style="height: 60px; display: flex; align-items: end;">
                                    <div class="bg-primary rounded-bottom" style="width: 100%; height: 48px;"></div>
                                </div>
                                <small class="fw-bold mt-1 d-block">19.7k</small>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted">Sam</small>
                            <div class="mt-2">
                                <div class="bg-warning bg-opacity-10 rounded" style="height: 60px; display: flex; align-items: end;">
                                    <div class="bg-warning rounded-bottom" style="width: 100%; height: 30px;"></div>
                                </div>
                                <small class="fw-bold mt-1 d-block">12.3k</small>
                            </div>
                        </div>
                        <div class="col">
                            <small class="text-muted">Dim</small>
                            <div class="mt-2">
                                <div class="bg-info bg-opacity-10 rounded" style="height: 60px; display: flex; align-items: end;">
                                    <div class="bg-info rounded-bottom" style="width: 100%; height: 25px;"></div>
                                </div>
                                <small class="fw-bold mt-1 d-block">8.9k</small>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3 text-center">
                        <small class="text-muted">
                            Moyenne quotidienne: <span class="fw-bold text-primary">17.2k €</span>
                            <span class="text-success ms-2">+12% vs semaine précédente</span>
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Répartition des ventes par secteur -->
        <div class="col-lg-6 mb-3">
            <div class="card border-success">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-chart-pie me-2 text-success"></i>Répartition par secteur
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div class="d-flex align-items-center">
                                <div class="bg-primary rounded me-2" style="width: 12px; height: 12px;"></div>
                                <span class="small">Informatique</span>
                            </div>
                            <div class="text-end">
                                <span class="fw-bold">45%</span>
                                <div class="small text-muted">56 580 €</div>
                            </div>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-primary" style="width: 45%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div class="d-flex align-items-center">
                                <div class="bg-success rounded me-2" style="width: 12px; height: 12px;"></div>
                                <span class="small">Bureautique</span>
                            </div>
                            <div class="text-end">
                                <span class="fw-bold">30%</span>
                                <div class="small text-muted">37 755 €</div>
                            </div>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-success" style="width: 30%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div class="d-flex align-items-center">
                                <div class="bg-warning rounded me-2" style="width: 12px; height: 12px;"></div>
                                <span class="small">Accessoires</span>
                            </div>
                            <div class="text-end">
                                <span class="fw-bold">15%</span>
                                <div class="small text-muted">18 878 €</div>
                            </div>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-warning" style="width: 15%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-0">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div class="d-flex align-items-center">
                                <div class="bg-info rounded me-2" style="width: 12px; height: 12px;"></div>
                                <span class="small">Services</span>
                            </div>
                            <div class="text-end">
                                <span class="fw-bold">10%</span>
                                <div class="small text-muted">12 585 €</div>
                            </div>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-info" style="width: 10%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Indicateurs clés de performance -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-warning">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-tachometer-alt me-2 text-warning"></i>Indicateurs Clés de Performance (KPI)
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="text-center p-3 bg-light rounded">
                                <h3 class="text-primary mb-1">537 €</h3>
                                <small class="text-muted">Panier moyen</small>
                                <div class="mt-2">
                                    <span class="badge bg-success">+8% vs mois dernier</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="text-center p-3 bg-light rounded">
                                <h3 class="text-success mb-1">68.2%</h3>
                                <small class="text-muted">Taux de conversion</small>
                                <div class="mt-2">
                                    <span class="badge bg-success">+3.1% vs mois dernier</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="text-center p-3 bg-light rounded">
                                <h3 class="text-warning mb-1">2.8</h3>
                                <small class="text-muted">Commandes par client</small>
                                <div class="mt-2">
                                    <span class="badge bg-warning">Stable</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3">
                            <div class="text-center p-3 bg-light rounded">
                                <h3 class="text-info mb-1">4.2 j</h3>
                                <small class="text-muted">Délai moyen livraison</small>
                                <div class="mt-2">
                                    <span class="badge bg-danger">+0.5j vs mois dernier</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tableau performance détaillée -->
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-table me-2"></i>Performance détaillée de l'équipe
            </h5>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-secondary btn-sm" onclick="exportTable()">
                    <i class="fas fa-file-excel me-1"></i>Excel
                </button>
                <button class="btn btn-outline-info btn-sm" onclick="printTable()">
                    <i class="fas fa-print me-1"></i>Imprimer
                </button>
            </div>
        </div>
        <div class="card-body">
            <!-- Données de performance de démonstration -->
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                    <tr>
                        <th><i class="fas fa-user me-1"></i>Vendeur</th>
                        <th class="text-end"><i class="fas fa-euro-sign me-1"></i>CA</th>
                        <th class="text-end"><i class="fas fa-bullseye me-1"></i>Objectif</th>
                        <th class="text-center"><i class="fas fa-percentage me-1"></i>Réalisation</th>
                        <th class="text-center"><i class="fas fa-shopping-cart me-1"></i>Commandes</th>
                        <th class="text-center"><i class="fas fa-users me-1"></i>Clients</th>
                        <th class="text-center">Statut</th>
                        <th class="text-center">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Vendeur 1 -->
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="me-2">
                                    <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                         style="width: 32px; height: 32px;">
                                        <i class="fas fa-user text-primary small"></i>
                                    </div>
                                </div>
                                <div><strong>Marie Dubois</strong></div>
                            </div>
                        </td>
                        <td class="text-end"><strong>45 250 €</strong></td>
                        <td class="text-end text-muted">50 000 €</td>
                        <td class="text-center">
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="progress me-2" style="height: 20px; min-width: 100px;">
                                    <div class="progress-bar bg-primary fw-bold" role="progressbar" style="width: 90.5%">
                                        <span>90.5%</span>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="text-center"><span class="badge bg-light text-dark">89</span></td>
                        <td class="text-center"><span class="badge bg-light text-dark">67</span></td>
                        <td class="text-center">
                            <span class="badge bg-primary">En bonne voie</span>
                        </td>
                        <td class="text-center">
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" title="Voir détails">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-success" title="Définir objectif">
                                    <i class="fas fa-bullseye"></i>
                                </button>
                            </div>
                        </td>
                    </tr>

                    <!-- Vendeur 2 -->
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="me-2">
                                    <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                         style="width: 32px; height: 32px;">
                                        <i class="fas fa-user text-primary small"></i>
                                    </div>
                                </div>
                                <div><strong>Pierre Martin</strong></div>
                            </div>
                        </td>
                        <td class="text-end"><strong>52 100 €</strong></td>
                        <td class="text-end text-muted">45 000 €</td>
                        <td class="text-center">
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="progress me-2" style="height: 20px; min-width: 100px;">
                                    <div class="progress-bar bg-success fw-bold" role="progressbar" style="width: 115.8%">
                                        <span>115.8%</span>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="text-center"><span class="badge bg-light text-dark">97</span></td>
                        <td class="text-center"><span class="badge bg-light text-dark">54</span></td>
                        <td class="text-center">
                            <span class="badge bg-success">Objectif atteint</span>
                        </td>
                        <td class="text-center">
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" title="Voir détails">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-success" title="Définir objectif">
                                    <i class="fas fa-bullseye"></i>
                                </button>
                            </div>
                        </td>
                    </tr>

                    <!-- Vendeur 3 -->
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="me-2">
                                    <div class="bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center"
                                         style="width: 32px; height: 32px;">
                                        <i class="fas fa-user text-primary small"></i>
                                    </div>
                                </div>
                                <div><strong>Sophie Legrand</strong></div>
                            </div>
                        </td>
                        <td class="text-end"><strong>28 500 €</strong></td>
                        <td class="text-end text-muted">40 000 €</td>
                        <td class="text-center">
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="progress me-2" style="height: 20px; min-width: 100px;">
                                    <div class="progress-bar bg-warning text-dark fw-bold" role="progressbar" style="width: 71.3%">
                                        <span>71.3%</span>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="text-center"><span class="badge bg-light text-dark">48</span></td>
                        <td class="text-center"><span class="badge bg-light text-dark">35</span></td>
                        <td class="text-center">
                            <span class="badge bg-warning">À surveiller</span>
                        </td>
                        <td class="text-center">
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" title="Voir détails">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-success" title="Définir objectif">
                                    <i class="fas fa-bullseye"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>

<!-- JavaScript avec Chart.js et fonctionnalités avancées -->
<th:block th:fragment="js_assets">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Date Range Picker -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <script th:inline="javascript">
        // Données depuis le serveur avec fallback enrichi
        const dashboardData = {
            teamPerformance: /*[[${dashboardData?.revenueByTeamMember ?: {}}]]*/ [
                { name: 'Marie Dubois', revenue: 45250, orders: 89, clients: 67 },
                { name: 'Pierre Martin', revenue: 52100, orders: 97, clients: 54 },
                { name: 'Sophie Legrand', revenue: 28500, orders: 48, clients: 35 },
                { name: 'Thomas Durand', revenue: 38900, orders: 72, clients: 42 },
                { name: 'Julie Moreau', revenue: 31800, orders: 58, clients: 39 }
            ],
            ordersData: /*[[${dashboardData?.ordersByTeamMember ?: {}}]]*/ [
                { name: 'Marie Dubois', orders: 89 },
                { name: 'Pierre Martin', orders: 97 },
                { name: 'Sophie Legrand', orders: 48 },
                { name: 'Thomas Durand', orders: 72 },
                { name: 'Julie Moreau', orders: 58 }
            ],
            clientsData: /*[[${dashboardData?.clientsByTeamMember ?: {}}]]*/ [
                { name: 'Marie Dubois', clients: 67 },
                { name: 'Pierre Martin', clients: 54 },
                { name: 'Sophie Legrand', clients: 35 },
                { name: 'Thomas Durand', clients: 42 },
                { name: 'Julie Moreau', clients: 39 }
            ]
        };

        let currentChart = null;
        let currentDataType = 'revenue';

        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser le graphique
            initializeChart();

            // Initialiser le date range picker
            initializeDateRangePicker();

            // Auto-refresh des données toutes les 5 minutes
            setInterval(refreshData, 300000);

            console.log('Dashboard Manager initialisé');
        });

        function initializeChart() {
            const ctx = document.getElementById('teamPerformanceChart');
            if (!ctx) return;

            const ctxContext = ctx.getContext('2d');

            // Utiliser les données enrichies
            const defaultData = dashboardData.teamPerformance;

            currentChart = new Chart(ctxContext, {
                type: 'bar',
                data: {
                    labels: defaultData.map(item => item.name || 'N/A'),
                    datasets: [{
                        label: 'Chiffre d\'affaires (€)',
                        data: defaultData.map(item => item.revenue || 0),
                        backgroundColor: 'rgba(37, 99, 235, 0.8)',
                        borderColor: 'rgba(37, 99, 235, 1)',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: 'rgba(37, 99, 235, 1)',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    if (currentDataType === 'revenue') {
                                        return 'CA: ' + new Intl.NumberFormat('fr-FR', {
                                            style: 'currency',
                                            currency: 'EUR'
                                        }).format(context.parsed.y);
                                    }
                                    return context.dataset.label + ': ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    if (currentDataType === 'revenue') {
                                        return new Intl.NumberFormat('fr-FR', {
                                            style: 'currency',
                                            currency: 'EUR',
                                            notation: 'compact'
                                        }).format(value);
                                    }
                                    return value;
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        function switchChart(dataType) {
            if (!currentChart) return;

            // Mettre à jour les boutons actifs
            document.querySelectorAll('.card-header .btn-group button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            currentDataType = dataType;
            let data, label, color;

            switch(dataType) {
                case 'revenue':
                    data = dashboardData.teamPerformance.map(item => item.revenue || 0);
                    label = 'Chiffre d\'affaires (€)';
                    color = 'rgba(37, 99, 235, 0.8)';
                    break;
                case 'orders':
                    data = dashboardData.ordersData.length > 0 ?
                        dashboardData.ordersData.map(item => item.orders || 0) :
                        dashboardData.teamPerformance.map(item => item.orders || 0);
                    label = 'Nombre de commandes';
                    color = 'rgba(5, 150, 105, 0.8)';
                    break;
                case 'clients':
                    data = dashboardData.clientsData.length > 0 ?
                        dashboardData.clientsData.map(item => item.clients || 0) :
                        dashboardData.teamPerformance.map(item => item.clients || 0);
                    label = 'Nombre de clients';
                    color = 'rgba(3, 105, 161, 0.8)';
                    break;
            }

            currentChart.data.datasets[0].data = data;
            currentChart.data.datasets[0].label = label;
            currentChart.data.datasets[0].backgroundColor = color;
            currentChart.data.datasets[0].borderColor = color.replace('0.8', '1');

            currentChart.update('active');
        }

        function initializeDateRangePicker() {
            $('#dateRangePicker').daterangepicker({
                locale: {
                    format: 'DD/MM/YYYY',
                    separator: ' - ',
                    applyLabel: 'Appliquer',
                    cancelLabel: 'Annuler',
                    fromLabel: 'De',
                    toLabel: 'À',
                    customRangeLabel: 'Personnalisé',
                    weekLabel: 'S',
                    daysOfWeek: ['Di', 'Lu', 'Ma', 'Me', 'Je', 'Ve', 'Sa'],
                    monthNames: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin',
                        'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
                    firstDay: 1
                },
                ranges: {
                    'Aujourd\'hui': [moment(), moment()],
                    'Hier': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    '7 derniers jours': [moment().subtract(6, 'days'), moment()],
                    '30 derniers jours': [moment().subtract(29, 'days'), moment()],
                    'Ce mois': [moment().startOf('month'), moment().endOf('month')],
                    'Mois dernier': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                }
            }, function(start, end, label) {
                console.log('Nouvelle période sélectionnée: ' + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
                // Rediriger avec les nouvelles dates
                window.location.href = `/dashboard?startDate=${start.format('YYYY-MM-DD')}&endDate=${end.format('YYYY-MM-DD')}`;
            });
        }

        // Fonctions d'actions
        function refreshData() {
            showLoader();
            setTimeout(() => {
                location.reload();
            }, 1000);
        }

        function exportReport() {
            showNotification('Export en cours...', 'info');
            window.open('/manager/export-report?format=excel', '_blank');
        }

        function exportTable() {
            showNotification('Export Excel en cours...', 'info');
            window.open('/manager/export-performance?format=excel', '_blank');
        }

        function printTable() {
            window.print();
        }

        function manageTeam() {
            window.location.href = '/manager/team';
        }

        function viewMemberDetails(memberId) {
            window.location.href = `/users/${memberId}`;
        }

        function contactMember(email) {
            window.location.href = `mailto:${email}?subject=Suivi commercial`;
        }

        function viewDetails(userId) {
            window.location.href = `/manager/member-details/${userId}`;
        }

        function setObjective(userId) {
            // Ouvrir une modal ou rediriger vers la page d'objectifs
            window.location.href = `/manager/set-objective/${userId}`;
        }

        function showLoader() {
            const loader = document.getElementById('chartLoader');
            if (loader) {
                loader.style.display = 'block';
            }
        }

        function showNotification(message, type = 'info') {
            const alertClass = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            }[type] || 'alert-info';

            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 350px;';
            alertDiv.innerHTML = `
            <i class="fas fa-info-circle me-2"></i>${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

            document.body.appendChild(alertDiv);

            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }
    </script>
</th:block>

</body>
</html>