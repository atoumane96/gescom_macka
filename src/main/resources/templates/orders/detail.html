<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: layout(~{::title}, ~{::content}, ~{::js_assets})}">
<head>
    <title th:text="'Commande ' + ${order.orderNumber}">Détails Commande</title>
</head>
<body>

<div th:fragment="content" class="order-detail-page">
    <style>
        /* === VARIABLES CSS === */
        .order-detail-page {
            --primary-color: #2563eb;
            --primary-light: #3b82f6;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --info-color: #0891b2;

            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;

            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);

            --border-radius: 0.5rem;
            --border-radius-lg: 0.75rem;

            min-height: 100vh;
            background-color: var(--gray-50);
            color: var(--gray-900);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
        }

        /* === TYPOGRAPHIE === */
        .order-detail-page h1, .order-detail-page h2, .order-detail-page h3,
        .order-detail-page h4, .order-detail-page h5, .order-detail-page h6 {
            font-weight: 600;
            line-height: 1.3;
            color: var(--gray-900);
        }

        .order-detail-page p {
            color: var(--gray-700);
        }

        /* === HEADER PRINCIPAL === */
        .order-header {
            background-color: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .order-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--gray-900);
        }

        .order-status {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 0.875rem;
            background-color: var(--primary-color);
            color: white;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .info-item {
            background-color: var(--gray-50);
            padding: 1.25rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-200);
        }

        .info-label {
            display: flex;
            align-items: center;
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .info-label i {
            margin-right: 0.5rem;
            width: 16px;
            color: var(--primary-color);
        }

        .info-value {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .total-amount {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        /* === CARTES DE SECTION === */
        .section-card {
            background-color: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--gray-200);
        }

        .section-header {
            background-color: var(--gray-50);
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .section-title {
            display: flex;
            align-items: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
            margin: 0;
        }

        .section-title i {
            margin-right: 0.75rem;
            color: var(--primary-color);
            width: 20px;
        }

        .section-content {
            padding: 1.5rem;
        }

        /* === TABLEAU === */
        .products-table {
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 1px solid var(--gray-200);
        }

        .products-table th {
            background-color: var(--primary-color) !important;
            color: white !important;
            font-weight: 600;
            font-size: 0.875rem;
            padding: 1rem !important;
            border: none !important;
        }

        .products-table td {
            padding: 1rem !important;
            border-bottom: 1px solid var(--gray-200) !important;
            vertical-align: middle;
        }

        .product-row:hover {
            background-color: var(--gray-50) !important;
        }

        .product-info {
            display: flex;
            align-items: center;
        }

        .product-image {
            width: 48px;
            height: 48px;
            background-color: var(--primary-color);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: white;
        }

        .product-name {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .product-ref {
            font-size: 0.875rem;
            color: var(--gray-500);
        }

        /* === TIMELINE === */
        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0.75rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--gray-300);
        }

        .timeline-item {
            position: relative;
            background-color: white;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -1.5rem;
            top: 1.25rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--gray-300);
            border: 3px solid white;
        }

        .timeline-item.completed::before {
            background-color: var(--success-color);
        }

        .timeline-item h6 {
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        /* === RÉSUMÉ FINANCIER === */
        .financial-summary {
            background-color: var(--gray-50);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            border: 1px solid var(--gray-200);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .summary-row:last-child {
            border-bottom: none;
            border-top: 2px solid var(--primary-color);
            margin-top: 1rem;
            padding-top: 1rem;
            font-weight: 700;
            background-color: var(--primary-color);
            color: white;
            margin: 1rem -1.5rem 0;
            padding: 1rem 1.5rem;
        }

        .summary-label {
            color: var(--gray-700);
            font-weight: 500;
        }

        .summary-value {
            font-weight: 600;
            color: var(--gray-900);
        }

        .summary-row:last-child .summary-label,
        .summary-row:last-child .summary-value {
            color: white;
        }

        /* === ADRESSES === */
        .address-card {
            background-color: var(--gray-50);
            border-radius: var(--border-radius);
            padding: 1.25rem;
            border: 1px solid var(--gray-200);
            margin-bottom: 1rem;
        }

        .address-title {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
        }

        .address-title i {
            margin-right: 0.5rem;
            color: var(--primary-color);
        }

        .address-content {
            white-space: pre-line;
            color: var(--gray-700);
            margin: 0;
        }

        /* === BOUTONS === */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .btn-action {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.25rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            text-decoration: none;
            border: 1px solid transparent;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .btn-action i {
            margin-right: 0.5rem;
        }

        .btn-primary-action {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary-action:hover {
            background-color: var(--primary-light);
            color: white;
            text-decoration: none;
        }

        .btn-success-action {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success-action:hover {
            background-color: #047857;
            color: white;
            text-decoration: none;
        }

        .btn-outline-action {
            background-color: white;
            color: var(--gray-700);
            border-color: var(--gray-300);
        }

        .btn-outline-action:hover {
            background-color: var(--gray-50);
            color: var(--gray-900);
            text-decoration: none;
        }

        /* === BADGES === */
        .badge {
            border-radius: var(--border-radius);
            padding: 0.375rem 0.75rem;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .bg-primary {
            background-color: var(--primary-color) !important;
            color: white !important;
        }

        /* === CLIENT INFO === */
        .client-info {
            background-color: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .client-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.75rem;
        }

        .client-detail {
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

        .client-detail i {
            margin-right: 0.5rem;
            color: var(--primary-color);
            width: 16px;
        }

        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .order-header {
                padding: 1.5rem;
            }

            .order-number {
                font-size: 2rem;
            }

            .total-amount {
                font-size: 1.5rem;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .section-content {
                padding: 1rem;
            }

            .section-header {
                padding: 1rem;
            }

            .action-buttons {
                justify-content: stretch;
            }

            .btn-action {
                flex: 1;
                justify-content: center;
            }
        }

        /* === IMPRESSION === */
        @media print {
            .action-buttons {
                display: none !important;
            }

            .order-detail-page {
                background-color: white !important;
            }

            .section-card {
                break-inside: avoid;
                box-shadow: none !important;
                border: 1px solid var(--gray-300) !important;
            }
        }

        /* === COULEURS DE TEXTE === */
        .order-detail-page * {
            color: inherit;
        }

        .order-detail-page .products-table tbody td,
        .order-detail-page .product-name,
        .order-detail-page .section-title {
            color: var(--gray-900) !important;
        }

        .order-detail-page .product-ref {
            color: var(--gray-500) !important;
        }

        .order-detail-page a {
            color: var(--primary-color) !important;
            text-decoration: none;
        }

        .order-detail-page a:hover {
            color: var(--primary-light) !important;
            text-decoration: underline;
        }
    </style>

    <!-- Contenu principal -->
    <!-- Page Header avec actions -->
    <div th:replace="~{fragments/components :: page-header(
        'Commande ' + ${order.orderNumber},
        'Détails complets de la commande',
        ~{::header-actions})}">
        <div th:fragment="header-actions" class="action-buttons">
            <a th:href="@{/orders}" class="btn-action btn-outline-action">
                <i class="fas fa-arrow-left"></i>
                Retour à la liste
            </a>
            <button type="button" class="btn-action btn-outline-action" onclick="printOrder()">
                <i class="fas fa-print"></i>
                Imprimer
            </button>
            <button type="button" class="btn-action btn-outline-action" onclick="sendByEmail()">
                <i class="fas fa-envelope"></i>
                Envoyer par email
            </button>
            <a th:href="@{/orders/{id}/edit(id=${order.id})}"
               th:if="${order.status.name() == 'DRAFT' or order.status.name() == 'CONFIRMED'}"
               class="btn-action btn-outline-primary" style="color:white">
                <i class="fas fa-edit"></i>
                Modifier
            </a>
        </div>
    </div>

    <!-- Header principal de la commande -->
    <div class="order-header">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="order-number" th:text="${order.orderNumber}">CMD-202401-001</div>

                <div class="order-status" th:switch="${order.status.name()}">
                    <span th:case="'DRAFT'">📝 Brouillon</span>
                    <span th:case="'PENDING'">⏳ En attente</span>
                    <span th:case="'CONFIRMED'">✅ Confirmée</span>
                    <span th:case="'PROCESSING'">🔄 En traitement</span>
                    <span th:case="'SHIPPED'">🚚 Expédiée</span>
                    <span th:case="'DELIVERED'">📦 Livrée</span>
                    <span th:case="'RETURNED'">↩️ Retournée</span>
                    <span th:case="'CANCELLED'">❌ Annulée</span>
                    <span th:case="*">❓ Statut inconnu</span>
                </div>

                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">
                            <i class="fas fa-calendar-alt"></i>
                            Date de commande
                        </div>
                        <div class="info-value" th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy à HH:mm')}">
                            01/01/2024 à 10:00
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">
                            <i class="fas fa-user-circle"></i>
                            Client
                        </div>
                        <div class="info-value" th:text="${order.client.name}">Nom du Client</div>
                    </div>

                    <div class="info-item" th:if="${order.expectedDeliveryDate}">
                        <div class="info-label">
                            <i class="fas fa-shipping-fast"></i>
                            Livraison prévue
                        </div>
                        <div class="info-value" th:text="${#temporals.format(order.expectedDeliveryDate, 'dd/MM/yyyy')}">
                            05/01/2024
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 text-center">
                <div class="info-label">
                    <i class="fas fa-euro-sign"></i>
                    Montant total
                </div>
                <div class="total-amount" th:text="${order.totalAmount != null ? #numbers.formatCurrency(order.totalAmount) : '0,00 €'}">
                    1 234,56 €
                </div>
                <div class="mt-3">
                    <span class="badge bg-primary" th:switch="${order.paymentStatus.name()}">
                        <span th:case="'PENDING'">💰 Paiement en attente</span>
                        <span th:case="'PARTIAL'">💳 Partiellement payé</span>
                        <span th:case="'PAID'">✅ Payé</span>
                        <span th:case="'OVERDUE'">⚠️ En retard</span>
                        <span th:case="*">❓ Statut inconnu</span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Colonne principale -->
        <div class="col-lg-8">

            <!-- Section des produits -->
            <div class="section-card">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-shopping-cart"></i>
                        Produits commandés
                    </h3>
                    <span class="badge bg-primary" th:text="${#lists.size(order.orderItems)} + ' article(s)'">
                        3 articles
                    </span>
                </div>
                <div class="section-content p-0">
                    <div class="table-responsive">
                        <table class="table table-hover products-table mb-0">
                            <thead>
                            <tr class="text-dark-emphasis">
                                <th style="width: 45%;">Produit</th>
                                <th class="text-center" style="width: 10%;">Quantité</th>
                                <th class="text-end" style="width: 15%;">Prix unitaire</th>
                                <th class="text-end" style="width: 15%;">Remise</th>
                                <th class="text-end" style="width: 15%;">Total HT</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="item : ${orderItems != null ? orderItems : order.orderItems}" class="product-row">
                                <td>
                                    <div class="product-info">
                                        <div class="product-image">
                                            <i class="fas fa-cube"></i>
                                        </div>
                                        <div>
                                            <div class="product-name" th:text="${item.product.name}">
                                                Nom du Produit
                                            </div>
                                            <div class="product-ref" th:text="'Réf: ' + ${item.product.reference}">
                                                Réf: REF-001
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="text-center align-middle">
                                    <strong th:text="${item.quantity}">2</strong>
                                </td>
                                <td class="text-end align-middle">
                                    <span th:text="${#numbers.formatCurrency(item.unitPrice)}">99,99 €</span>
                                </td>
                                <td class="text-end align-middle">
                                        <span th:if="${item.discountRate != null and item.discountRate > 0}"
                                              th:text="${#numbers.formatDecimal(item.discountRate, 1, 2)} + ' %'">
                                            5,00 %
                                        </span>
                                    <span th:unless="${item.discountRate != null and item.discountRate > 0}">
                                            -
                                        </span>
                                </td>
                                <td class="text-end align-middle">
                                    <strong th:text="${#numbers.formatCurrency(item.totalPriceHT)}">189,98 €</strong>
                                </td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(orderItems != null ? orderItems : order.orderItems)}">
                                <td colspan="5" class="text-center text-muted py-5">
                                    <i class="fas fa-shopping-cart fa-3x mb-3 d-block opacity-25"></i>
                                    <strong>Aucun produit dans cette commande</strong>
                                    <p class="mb-0">La commande ne contient aucun article.</p>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Section historique/timeline -->
            <div class="section-card">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-history"></i>
                        Suivi de la commande
                    </h3>
                </div>
                <div class="section-content">
                    <div class="timeline">
                        <div class="timeline-item completed">
                            <h6 class="mb-2">🎯 Commande créée</h6>
                            <p class="mb-2 text-muted" th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy à HH:mm')}">
                                01/01/2024 à 10:00
                            </p>
                            <p class="mb-0 small">
                                Par <strong th:text="${order.user?.firstName + ' ' + order.user?.lastName ?: 'Système'}">Jean Dupont</strong>
                            </p>
                        </div>

                        <div class="timeline-item"
                             th:class="${order.status.name() == 'CONFIRMED' or order.status.name() == 'PROCESSING' or order.status.name() == 'SHIPPED' or order.status.name() == 'DELIVERED'} ? 'timeline-item completed' : 'timeline-item'">
                            <h6 class="mb-2">✅ Commande confirmée</h6>
                            <p class="mb-0 text-muted small"
                               th:text="${order.status.name() == 'CONFIRMED' or order.status.name() == 'PROCESSING' or order.status.name() == 'SHIPPED' or order.status.name() == 'DELIVERED'} ? 'Commande validée et prête pour traitement' : 'En attente de confirmation'">
                                En attente de confirmation
                            </p>
                        </div>

                        <div class="timeline-item"
                             th:class="${order.status.name() == 'PROCESSING' or order.status.name() == 'SHIPPED' or order.status.name() == 'DELIVERED'} ? 'timeline-item completed' : 'timeline-item'">
                            <h6 class="mb-2">🔄 En cours de traitement</h6>
                            <p class="mb-0 text-muted small"
                               th:text="${order.status.name() == 'PROCESSING' or order.status.name() == 'SHIPPED' or order.status.name() == 'DELIVERED'} ? 'Commande en cours de préparation' : 'En attente de traitement'">
                                En attente de traitement
                            </p>
                        </div>

                        <div class="timeline-item"
                             th:class="${order.status.name() == 'SHIPPED' or order.status.name() == 'DELIVERED'} ? 'timeline-item completed' : 'timeline-item'">
                            <h6 class="mb-2">🚚 Expédiée</h6>
                            <p class="mb-0 text-muted small"
                               th:text="${order.status.name() == 'SHIPPED' or order.status.name() == 'DELIVERED'} ? 'Commande expédiée' : 'En attente d\'expédition'">
                                En attente d'expédition
                            </p>
                        </div>

                        <div class="timeline-item"
                             th:class="${order.status.name() == 'DELIVERED'} ? 'timeline-item completed' : 'timeline-item'">
                            <h6 class="mb-2">📦 Livrée</h6>
                            <p class="mb-0 text-muted small"
                               th:text="${order.status.name() == 'DELIVERED'} ? 'Commande livrée avec succès' : 'En attente de livraison'">
                                En attente de livraison
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Colonne latérale -->
        <div class="col-lg-4">

            <!-- Informations client -->
            <div class="section-card">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-user-circle"></i>
                        Client
                    </h3>
                </div>
                <div class="section-content">
                    <div class="client-info">
                        <h5 class="client-name" th:text="${order.client.name}">Nom du Client</h5>
                        <div class="client-detail" th:if="${order.client.companyName}">
                            <i class="fas fa-building"></i>
                            <span th:text="${order.client.companyName}">Nom de l'entreprise</span>
                        </div>
                        <div class="client-detail">
                            <i class="fas fa-envelope"></i>
                            <a th:href="'mailto:' + ${order.client.email}"
                               th:text="${order.client.email}">email@client.com</a>
                        </div>
                        <div class="client-detail" th:if="${order.client.phoneNumber}">
                            <i class="fas fa-phone"></i>
                            <a th:href="'tel:' + ${order.client.phoneNumber}"
                               th:text="${order.client.phoneNumber}">+33 1 23 45 67 89</a>
                        </div>
                    </div>
                    <div class="mt-3">
                        <a th:href="@{/clients/{id}(id=${order.client.id})}" class="btn-action btn-outline-action">
                            <i class="fas fa-eye"></i>
                            Voir la fiche
                        </a>
                    </div>
                </div>
            </div>

            <!-- Adresses -->
            <div class="section-card">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Adresses
                    </h3>
                </div>
                <div class="section-content">
                    <div class="address-card">
                        <div class="address-title">
                            <i class="fas fa-file-invoice"></i>
                            Facturation
                        </div>
                        <div class="address-content" th:text="${order.billingAddress ?: 'Adresse non spécifiée'}">
                            123 Rue de la Facture
                            75001 Paris, France
                        </div>
                    </div>

                    <div class="address-card">
                        <div class="address-title">
                            <i class="fas fa-shipping-fast"></i>
                            Livraison
                        </div>
                        <div class="address-content" th:text="${order.shippingAddress ?: 'Adresse non spécifiée'}">
                            456 Avenue de la Livraison
                            75002 Paris, France
                        </div>
                    </div>
                </div>
            </div>

            <!-- Résumé financier -->
            <div class="section-card">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-calculator"></i>
                        Résumé financier
                    </h3>
                </div>
                <div class="section-content">
                    <div class="financial-summary">
                        <div class="summary-row">
                            <span class="summary-label">Sous-total HT :</span>
                            <span class="summary-value" th:text="${#numbers.formatCurrency(order.totalAmountHT ?: 0)}">1 000,00 €</span>
                        </div>

                        <div class="summary-row" th:if="${order.discountAmount != null and order.discountAmount > 0}">
                            <span class="summary-label">Remise :</span>
                            <span class="summary-value text-danger">
                                -<span th:text="${#numbers.formatCurrency(order.discountAmount)}">50,00 €</span>
                            </span>
                        </div>

                        <div class="summary-row">
                            <span class="summary-label">TVA :</span>
                            <span class="summary-value" th:text="${#numbers.formatCurrency(order.totalVatAmount ?: 0)}">200,00 €</span>
                        </div>

                        <div class="summary-row" th:if="${order.shippingCost != null and order.shippingCost > 0}">
                            <span class="summary-label">Frais de port :</span>
                            <span class="summary-value" th:text="${#numbers.formatCurrency(order.shippingCost)}">15,00 €</span>
                        </div>

                        <div class="summary-row">
                            <span class="summary-label">Total TTC :</span>
                            <span class="summary-value" th:text="${#numbers.formatCurrency(order.totalAmount ?: 0)}">1 234,56 €</span>
                        </div>
                    </div>

                    <!-- Actions de facturation -->
                    <div class="mt-4">
                        <div class="d-grid gap-2">
                            <!-- Bouton de génération de facture - Méthode GET (formulaire) -->
                            <a th:href="@{/invoices/new(orderId=${order.id})}"
                               th:if="${canInvoice}"
                               class="btn-action btn-primary-action w-100 text-center">
                                <i class="fas fa-file-invoice-dollar"></i>
                                Créer une facture
                            </a>

                            <!-- Bouton de génération rapide - Méthode POST (direct) -->
                            <form th:if="${canInvoice}" th:action="@{/orders/{id}/create-invoice(id=${order.id})}" method="post" class="mt-2">
                                <button type="submit" class="btn-action btn-success-action w-100"
                                        onclick="return confirm('Créer une facture automatiquement à partir de cette commande ?')">
                                    <i class="fas fa-bolt"></i>
                                    Facture automatique
                                </button>
                            </form>

                            <a th:href="@{/invoices/{id}(id=${order.invoice.id})}"
                               th:if="${order.invoice != null}"
                               class="btn-action btn-outline-success w-100 text-center">
                                <i class="fas fa-file-invoice"></i>
                                Voir la facture
                            </a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Section des notes -->
    <div class="row" th:if="${(order.notes != null and !#strings.isEmpty(order.notes)) or (order.internalNotes != null and !#strings.isEmpty(order.internalNotes))}">
        <div class="col-12">
            <div class="section-card">
                <div class="section-header">
                    <h3 class="section-title">
                        <i class="fas fa-sticky-note"></i>
                        Notes
                    </h3>
                </div>
                <div class="section-content">
                    <div class="row">
                        <div class="col-md-6" th:if="${order.notes}">
                            <div class="address-card">
                                <h6 class="address-title">
                                    <i class="fas fa-comment"></i>
                                    Notes client
                                </h6>
                                <p class="mb-0" th:text="${order.notes}">Notes visibles par le client</p>
                            </div>
                        </div>
                        <div class="col-md-6" th:if="${order.internalNotes}">
                            <div class="address-card">
                                <h6 class="address-title">
                                    <i class="fas fa-lock"></i>
                                    Notes internes
                                </h6>
                                <p class="mb-0" th:text="${order.internalNotes}">Notes internes uniquement</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<th:block th:fragment="js_assets">
    <script>
        // === FONCTIONS BASIQUES ===
        function printOrder() {
            window.print();
        }

        function sendByEmail() {
            const orderNumber = /*[[${order.orderNumber}]]*/ 'CMD-001';
            const clientEmail = /*[[${order.client.email}]]*/ 'client@example.com';

            if (confirm(`Envoyer la commande ${orderNumber} par email à ${clientEmail} ?`)) {
                alert('Fonctionnalité d\'envoi par email à implémenter');
            }
        }

        // === INITIALISATION SIMPLE ===
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page de détail de commande chargée');
        });
    </script>
</th:block>

</body>
</html>